---
title: "Overall Survival from Neoadjuvant Treatment"
author: "Derek Chiu"
date: "June 30, 2015"
output: word_document
---

```{r, echo=FALSE, message=FALSE}
library(biostatUtil)
library(bccaNeoadjuvant)
data("neoadjuvant")
dat <- neoadjuvant
```

# Introduction
There are six biomarkers, each of which can be used as predictors in Cox proportional hazard models for overall survival of patients undergoing neoadjuvant treatment. They are measured in densities, and are hypothesized to improve survival.

# Exploratory Analysis
Before we begin the Cox modeling, it is important to verify that the cohorts do not vary substantially in terms of their time of follow up. This can be a potential confounder: if a certain cohort was followed up for a longer time compared to another cohort, then a group of patients with better survival might be explained by the cohort they were in and not by the biomarker densities.

```{r, echo=FALSE}
knitr::kable(summary(lm(Time ~ Cohort, dat))$coefficients, digits = 5)
```

The reference group is the NAC cohort. We see that the average follow-up time at NAC is significantly greater than the follow-up time at TGH. Therefore, we should include **Cohort** as a covariate in our models to account for its variation in follow-up time.

# Univariable Analysis
We run 12 models, two for each of the six biomarkers in a univariable analysis, one that includes cohort and one that excludes cohort as a covariate.

## CD3
**Without Cohort**
```{r, echo=FALSE, results='asis'}
mod.CD3 <- prettyCoxph(Surv(Time, Status) ~ CD3, dat)$output[, -5]
knitr::kable(t(as.matrix(setNames(as.numeric(mod.CD3), names(mod.CD3)))), digits = 5)
```

**With Cohort**
```{r, echo=FALSE, results='asis'}
mod.CD3.cohort <- prettyCoxph(Surv(Time, Status) ~ CD3 + Cohort, dat)$output[, -5]
knitr::kable(matrix(as.numeric(mod.CD3.cohort), ncol = 4, dimnames = list(rownames(mod.CD3.cohort), colnames(mod.CD3.cohort))))
```

## CD8

**Without Cohort**
```{r, echo=FALSE, results='asis'}
mod.CD8 <- prettyCoxph(Surv(Time, Status) ~ CD8, dat)$output[, -5]
knitr::kable(t(as.matrix(setNames(as.numeric(mod.CD8), names(mod.CD8)))), digits = 5)
```

**With Cohort**
```{r, echo=FALSE, results='asis'}
mod.CD8.cohort <- prettyCoxph(Surv(Time, Status) ~ CD8 + Cohort, dat)$output[, -5]
knitr::kable(matrix(as.numeric(mod.CD8.cohort), ncol = 4, dimnames = list(rownames(mod.CD8.cohort), colnames(mod.CD8.cohort))))
```

## CD20

**Without Cohort**
```{r, echo=FALSE, results='asis'}
mod.CD20 <- prettyCoxph(Surv(Time, Status) ~ CD20, dat)$output[, -5]
knitr::kable(t(as.matrix(setNames(as.numeric(mod.CD20), names(mod.CD20)))), digits = 5)
```

**With Cohort**
```{r, echo=FALSE, results='asis'}
mod.CD20.cohort <- prettyCoxph(Surv(Time, Status) ~ CD20 + Cohort, dat)$output[, -5]
knitr::kable(matrix(as.numeric(mod.CD20.cohort), ncol = 4, dimnames = list(rownames(mod.CD20.cohort), colnames(mod.CD20.cohort))))
```

## TIA.1

**Without Cohort**
```{r, echo=FALSE, results='asis'}
mod.TIA.1 <- prettyCoxph(Surv(Time, Status) ~ TIA.1, dat)$output[, -5]
knitr::kable(t(as.matrix(setNames(as.numeric(mod.TIA.1), names(mod.TIA.1)))), digits = 5)
```

**With Cohort**
```{r, echo=FALSE, results='asis'}
mod.TIA.1.cohort <- prettyCoxph(Surv(Time, Status) ~ TIA.1 + Cohort, dat)$output[, -5]
knitr::kable(matrix(as.numeric(mod.TIA.1.cohort), ncol = 4, dimnames = list(rownames(mod.TIA.1.cohort), colnames(mod.TIA.1.cohort))))
```

## PD.1

**Without Cohort**
```{r, echo=FALSE, results='asis'}
mod.PD.1 <- prettyCoxph(Surv(Time, Status) ~ PD.1, dat)$output[, -5]
knitr::kable(t(as.matrix(setNames(as.numeric(mod.PD.1), names(mod.PD.1)))), digits = 5)
```

**With Cohort**
```{r, echo=FALSE, results='asis'}
mod.PD.1.cohort <- prettyCoxph(Surv(Time, Status) ~ PD.1 + Cohort, dat)$output[, -5]
knitr::kable(matrix(as.numeric(mod.PD.1.cohort), ncol = 4, dimnames = list(rownames(mod.PD.1.cohort), colnames(mod.PD.1.cohort))))
```

## FoxP3

**Without Cohort**
```{r, echo=FALSE, results='asis'}
mod.FoxP3 <- prettyCoxph(Surv(Time, Status) ~ FoxP3, dat)$output[, -5]
knitr::kable(t(as.matrix(setNames(as.numeric(mod.FoxP3), names(mod.FoxP3)))), digits = 5)
```

**With Cohort**
```{r, echo=FALSE, results='asis'}
mod.FoxP3.cohort <- prettyCoxph(Surv(Time, Status) ~ FoxP3 + Cohort, dat)$output[, -5]
knitr::kable(matrix(as.numeric(mod.FoxP3.cohort), ncol = 4, dimnames = list(rownames(mod.FoxP3.cohort), colnames(mod.FoxP3.cohort))))
```

None of the biomarkers are significant at any level when accounting for Cohort. **CD20** is significant at 5% level when we do not account for Cohort, however. It appears that the survival is only associated with the patient's cohort.

# Multivariable Analysis

This model includes all six biomarkers as predictors.

**Without Cohort**
```{r, echo=FALSE, results='asis'}
mod.mult <- prettyCoxph(Surv(Time, Status) ~ CD3 + CD8 + CD20 + TIA.1 + PD.1 + FoxP3, dat)$output[, -5]
knitr::kable(matrix(as.numeric(mod.mult), ncol = 4, dimnames = list(rownames(mod.mult), colnames(mod.mult))))
```

**With Cohort**
```{r, echo=FALSE, results='asis'}
mod.mult.cohort <- prettyCoxph(Surv(Time, Status) ~ CD3 + CD8 + CD20 + TIA.1 + PD.1 + FoxP3 + Cohort, dat)$output[, -5]
knitr::kable(matrix(as.numeric(mod.mult.cohort), ncol = 4, dimnames = list(rownames(mod.mult.cohort), colnames(mod.mult.cohort))))
```

When accounting for all the biomarkers in the model along with cohort, we see that no biomarkers are significant at any level. 